<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sovannarot Math</title>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      @font-face {
        font-family: "Khmer";
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://raw.githubusercontent.com/sovannarot/learn/main/assets/font/khmer1.woff2)
          format("woff2");
        unicode-range: U+1780-17FF, U+19E0-19FF, U+200C-200D, U+25CC,
          U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC,
          U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191,
          U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
      body {
        background: white;
        font-family: "Khmer", sans-serif;
      }
    </style>
  </head>
  <body>
    <div
      class="w-full h-auto p-3 flex justify-center items-center flex-col gap-3"
    >
      <h1 id="first"></h1>
      <h1 id="second"></h1>
      <h1 id="third"></h1>
      <h1 id="fourth"></h1>
      <h1 id="fifth"></h1>

      <button
        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
        id="create"
      >
        បង្កើតលំហាត់
      </button>

      <button
        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
        id="solution"
      >
        ដំណោះស្រាយ
      </button>
      <div class="w-full h-3 bg-red-200"></div>
      <button
        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-blue-600 mt-4"
        id="set"
      >
        កំណត់ពិសេស</button
      ><a
        href="https://sovannarot.github.io/learn/math"
        style="
          background: blue;
          color: white;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: larger;
        "
      >
        Math List
      </a>
    </div>
    <script>
      let Result;
      const createButton = document.getElementById("create");
      const solutionButton = document.getElementById("solution");
      let denominatorlimit = 10;
      let numeratorlimit = 900;
      document.getElementById("set").addEventListener("click", () => {
        denominatorlimit = parseInt(
          prompt("កំណត់លំហាត់ Denominator (1-1000)", "10")
        );
        numeratorlimit = parseInt(
          prompt("កំណត់លំហាត់ Numerator (1-1000)", "900")
        );
      });
      const denominator = () =>
        Math.floor(Math.random() * denominatorlimit) + 1;
      const numerator = () => Math.floor(Math.random() * numeratorlimit) + 1;
      const radian = [
        0,
        Math.PI / 6,
        Math.PI / 4,
        Math.PI / 3,
        Math.PI / 2,
        (2 * Math.PI) / 3,
        (3 * Math.PI) / 4,
        (5 * Math.PI) / 6,
        Math.PI,
        (7 * Math.PI) / 6,
        (5 * Math.PI) / 4,
        (4 * Math.PI) / 3,
        (3 * Math.PI) / 2,
        (5 * Math.PI) / 3,
        (7 * Math.PI) / 4,
        (11 * Math.PI) / 6,
      ];
      const radianFrac = [
        "0",
        "\\frac{π}{6}",
        "\\frac{π}{4}",
        "\\frac{π}{3}",
        "\\frac{π}{2}",
        "\\frac{2π}{3}",
        "\\frac{3π}{4}",
        "\\frac{5π}{6}",
        "π",
        "\\frac{7π}{6}",
        "\\frac{5π}{4}",
        "\\frac{4π}{3}",
        "\\frac{3π}{2}",
        "\\frac{5π}{3}",
        "\\frac{7π}{4}",
        "\\frac{11π}{6}",
      ];
      function getDenominator(decimal, tolerance = 1.0e-8) {
        let h1 = 1,
          h2 = 0,
          k1 = 0,
          k2 = 1,
          b = decimal;
        let maxIter = 100;
        let iter = 0;
        do {
          let a = Math.floor(b);
          let aux = h1;
          h1 = a * h1 + h2;
          h2 = aux;
          aux = k1;
          k1 = a * k1 + k2;
          k2 = aux;
          b = 1 / (b - a);
          iter++;
          if (iter > maxIter) break;
        } while (Math.abs(decimal - h1 / k1) > tolerance * Math.abs(decimal));
        if (k1 > 1e6) {
          let str = decimal.toString();
          let match = str.match(/^(\d*)\.(\d*?)(\d{1,10})\3+$/);
          if (match) {
            let nonRepeat = match[2];
            let repeat = match[3];
            let nonRepeatLen = nonRepeat.length;
            let repeatLen = repeat.length;
            let numerator =
              parseInt(nonRepeat + repeat) -
              (nonRepeat ? parseInt(nonRepeat) : 0);
            let denominator =
              Math.pow(10, nonRepeatLen + repeatLen) -
              Math.pow(10, nonRepeatLen);
            let gcd = (a, b) => (b ? gcd(b, a % b) : a);
            let d = gcd(numerator, denominator);
            return denominator / d;
          }
        }
        return k1;
      }
      function getNumerator(decimal, tolerance = 1.0e-8) {
        let h1 = 1,
          h2 = 0,
          k1 = 0,
          k2 = 1,
          b = decimal;
        let maxIter = 100,
          iter = 0;
        do {
          let a = Math.floor(b);
          let aux = h1;
          h1 = a * h1 + h2;
          h2 = aux;
          aux = k1;
          k1 = a * k1 + k2;
          k2 = aux;
          b = 1 / (b - a);
          iter++;
          if (iter > maxIter) break;
        } while (Math.abs(decimal - h1 / k1) > tolerance * Math.abs(decimal));

        if (k1 > 1e6) {
          let str = decimal.toString();
          let match = str.match(/^(\d*)\.(\d*?)(\d{1,10})\3+$/);
          if (match) {
            let nonRepeat = match[2];
            let repeat = match[3];
            let nonRepeatLen = nonRepeat.length;
            let repeatLen = repeat.length;
            let numerator =
              parseInt(nonRepeat + repeat) -
              (nonRepeat ? parseInt(nonRepeat) : 0);
            let denominator =
              Math.pow(10, nonRepeatLen + repeatLen) -
              Math.pow(10, nonRepeatLen);
            let gcd = (a, b) => (b ? gcd(b, a % b) : a);
            let d = gcd(numerator, denominator);
            return numerator / d;
          }
        }
        return h1;
      }
      function smallestMultiplierToPerfectSquare(num) {
        let n = 1;
        let x = num;
        for (let i = 2; i * i <= x; i++) {
          let count = 0;
          while (x % i === 0) {
            x /= i;
            count++;
          }
          if (count % 2 !== 0) {
            n *= i;
          }
        }
        if (x > 1) n *= x;
        return n;
      }
      function getNumberForm(num) {
        let square = num * num;
        let denominator;
        let numerator;
        if (Number.isInteger(square)) {
          numerator = square;
          denominator = 1;
        } else {
          denominator = getDenominator(square);
          numerator = getNumerator(square);

          if (!Number.isInteger(Math.sqrt(denominator))) {
            let multiplier = smallestMultiplierToPerfectSquare(denominator);
            denominator *= multiplier;
            numerator *= multiplier;
          }
        }
        let coefficient = 1;
        let radical = numerator;
        for (let i = 2; i <= Math.sqrt(numerator); i++) {
          if (radical % (i * i) === 0) {
            coefficient *= i;
            radical /= i * i;
          }
        }
        return {
          numerator: { coefficient: coefficient, radical: radical },
          denominator: Math.sqrt(denominator),
        };
      }
      function setProblem() {
        let module = Math.sqrt(numerator()) / denominator();
        let radianIndex = Math.floor(Math.random() * radian.length);
        const a =
          radianIndex === 4 || radianIndex === 12
            ? 0
            : module * Math.cos(radian[radianIndex]);
        const b =
          radianIndex === 0 || radianIndex === 8
            ? 0
            : module * Math.sin(radian[radianIndex]);
        let aShow;
        let bShow;
        let aFun = getNumberForm(a);
        let bFun = getNumberForm(b);
        function signShow(value) {
          return value >= 0 ? "+" : "-";
        }
        if (aFun.denominator === 1) {
          if (aFun.numerator.radical === 1) {
            aShow = `${aFun.numerator.coefficient}`;
          } else if (aFun.numerator.radical === 0) {
            aShow = "";
          } else {
            if (aFun.numerator.coefficient === 1) {
              aShow = `\\sqrt{${aFun.numerator.radical}}`;
            } else {
              aShow = `${aFun.numerator.coefficient} \\sqrt{${aFun.numerator.radical}}`;
            }
          }
        } else {
          if (aFun.numerator.radical === 1) {
            aShow = `\\frac{${aFun.numerator.coefficient}}{${aFun.denominator}}`;
          } else if (aFun.numerator.radical === 0) {
            aShow = "";
          } else {
            if (aFun.numerator.coefficient === 1) {
              aShow = `\\frac{\\sqrt{${aFun.numerator.radical}}}{${aFun.denominator}}`;
            } else {
              aShow = `\\frac{${aFun.numerator.coefficient} \\sqrt{${aFun.numerator.radical}}}{${aFun.denominator}}`;
            }
          }
        }
        if (bFun.denominator === 1) {
          if (bFun.numerator.radical === 1) {
            if (bFun.numerator.coefficient === 1) {
              bShow = "";
            } else {
              bShow = `${bFun.numerator.coefficient}`;
            }
          } else if (bFun.numerator.radical === 0) {
            bShow = "";
          } else {
            if (bFun.numerator.coefficient === 1) {
              bShow = `\\sqrt{${bFun.numerator.radical}}`;
            } else {
              bShow = `${bFun.numerator.coefficient} \\sqrt{${bFun.numerator.radical}}`;
            }
          }
        } else {
          if (bFun.numerator.radical === 1) {
            if (bFun.numerator.coefficient === 1) {
              bShow = `\\frac{1}{${bFun.denominator}}`;
            } else {
              bShow = `\\frac{${bFun.numerator.coefficient}}{${bFun.denominator}}`;
            }
          } else if (bFun.numerator.radical === 0) {
            bShow = "";
          } else {
            if (bFun.numerator.coefficient === 1) {
              bShow = `\\frac{\\sqrt{${bFun.numerator.radical}}}{${bFun.denominator}}`;
            } else {
              bShow = `\\frac{${bFun.numerator.coefficient} \\sqrt{${bFun.numerator.radical}}}{${bFun.denominator}}`;
            }
          }
        }
        document.getElementById("first").innerHTML = `\\[z = ${
          aFun.numerator.radical === 0 ? "" : signShow(a) === "+" ? "" : "-"
        }${aShow}${
          bFun.numerator.radical === 0
            ? ""
            : radianIndex !== 4
            ? signShow(b)
            : signShow(b) === "+"
            ? ""
            : "-"
        }${bShow}${bFun.numerator.radical === 0 ? "" : "i"}\\]`;
        MathJax.typeset();
        Result = {
          aValue: a,
          a: aFun,
          aSign: signShow(a),
          bValue: b,
          b: bFun,
          bSign: signShow(b),
          radian: radianIndex,
        };
        document.getElementById("second").innerHTML = "";
        document.getElementById("third").innerHTML = "";
        document.getElementById("fourth").innerHTML = "";
        document.getElementById("fifth").innerHTML = "";
      }
      createButton.addEventListener("click", () => {
        setProblem();
      });
      solutionButton.addEventListener("click", () => {
        if (!Result) {
          setProblem();
        }
        const aFun = Result.a;
        const bFun = Result.b;
        let aShow;
        let bShow;
        if (aFun.denominator === 1) {
          if (aFun.numerator.radical === 1) {
            aShow = `${aFun.numerator.coefficient}`;
          } else if (aFun.numerator.radical === 0) {
            aShow = "0";
          } else {
            if (aFun.numerator.coefficient === 1) {
              aShow = `\\sqrt{${aFun.numerator.radical}}`;
            } else {
              aShow = `${aFun.numerator.coefficient} \\sqrt{${aFun.numerator.radical}}`;
            }
          }
        } else {
          if (aFun.numerator.radical === 1) {
            aShow = `\\frac{${aFun.numerator.coefficient}}{${aFun.denominator}}`;
          } else if (aFun.numerator.radical === 0) {
            aShow = "0";
          } else {
            if (aFun.numerator.coefficient === 1) {
              aShow = `\\frac{\\sqrt{${aFun.numerator.radical}}}{${aFun.denominator}}`;
            } else {
              aShow = `\\frac{${aFun.numerator.coefficient} \\sqrt{${aFun.numerator.radical}}}{${aFun.denominator}}`;
            }
          }
        }
        if (bFun.denominator === 1) {
          if (bFun.numerator.radical === 1) {
            if (bFun.numerator.coefficient === 1) {
              bShow = "0";
            } else {
              bShow = `${bFun.numerator.coefficient}`;
            }
          } else if (bFun.numerator.radical === 0) {
            bShow = "0";
          } else {
            if (bFun.numerator.coefficient === 1) {
              bShow = `\\sqrt{${bFun.numerator.radical}}`;
            } else {
              bShow = `${bFun.numerator.coefficient} \\sqrt{${bFun.numerator.radical}}`;
            }
          }
        } else {
          if (bFun.numerator.radical === 1) {
            if (bFun.numerator.coefficient === 1) {
              bShow = `\\frac{1}{${bFun.denominator}}`;
            } else {
              bShow = `\\frac{${bFun.numerator.coefficient}}{${bFun.denominator}}`;
            }
          } else if (bFun.numerator.radical === 0) {
            bShow = "0";
          } else {
            if (bFun.numerator.coefficient === 1) {
              bShow = `\\frac{\\sqrt{${bFun.numerator.radical}}}{${bFun.denominator}}`;
            } else {
              bShow = `\\frac{${bFun.numerator.coefficient} \\sqrt{${bFun.numerator.radical}}}{${bFun.denominator}}`;
            }
          }
        }
        const moduleValue = getNumberForm(
          Math.sqrt(Result.aValue ** 2 + Result.bValue ** 2)
        );
        let module =
          moduleValue.denominator === 1
            ? moduleValue.numerator.coefficient === 1
              ? moduleValue.numerator.radical === 0
                ? "0"
                : moduleValue.numerator.radical === 1
                ? `1`
                : `\\sqrt{${moduleValue.numerator.radical}}`
              : moduleValue.numerator.radical === 0
              ? "0"
              : moduleValue.numerator.radical === 1
              ? `${moduleValue.numerator.coefficient}`
              : `${moduleValue.numerator.coefficient} \\sqrt{${moduleValue.numerator.radical}}`
            : moduleValue.numerator.coefficient === 1
            ? moduleValue.numerator.radical === 0
              ? "0"
              : moduleValue.numerator.radical === 1
              ? `\\frac{1}{${moduleValue.denominator}}`
              : `\\frac{\\sqrt{${moduleValue.numerator.radical}}}{${moduleValue.denominator}}`
            : moduleValue.numerator.radical === 0
            ? "0"
            : moduleValue.numerator.radical === 1
            ? `\\frac{${moduleValue.numerator.coefficient}}{${moduleValue.denominator}}`
            : `\\frac{${moduleValue.numerator.coefficient} \\sqrt{${moduleValue.numerator.radical}}}{${moduleValue.denominator}}`;
        document.getElementById(
          "second"
        ).innerHTML = `ម៉ូឌុល៖ \\[|z| = r = \\sqrt{(${
          Result.aSign === "+" ? "" : "-"
        }${aShow})^2 + (${
          Result.bSign === "+" ? "" : "-"
        }${bShow})^2} = ${module}\\]`;
        function sinCos(absAnswer) {
          let fraction;
          if (absAnswer === "0.707107") {
            fraction = `\\frac{\\sqrt{2}}{2}`;
          } else if (absAnswer == "0.500000") {
            fraction = `\\frac{1}{2}`;
          } else if (absAnswer == "1.000000") {
            fraction = `1`;
          } else if (absAnswer == "0.866025") {
            fraction = `\\frac{\\sqrt{3}}{2}`;
          } else if (absAnswer == "0.000000") {
            fraction = "0";
          } else {
            fraction = `\\frac{\\sqrt{2}}{2}`;
          }
          return fraction;
        }
        document.getElementById(
          "third"
        ).innerHTML = `អាគុយម៉ង់៖ \\[\\cos(\\alpha)= ${
          Result.aSign === "+" ? "" : "-"
        }${sinCos(
          Math.abs(Math.cos(radian[Result.radian]).toFixed(6))
        )} \\quad\\& \\quad \\sin(\\alpha)= ${
          Result.bSign === "+" ? "" : "-"
        }${sinCos(Math.abs(Math.sin(radian[Result.radian]).toFixed(6)))}\\]`;
        document.getElementById("fourth").innerHTML = `\\[\\alpha = ${
          radianFrac[Result.radian] === "0" ? "" : radianFrac[Result.radian]
        }  ${
          radianFrac[Result.radian] === "0" ? "" : "+"
        } 2kπ,\\quad (k \\in \\mathbb{Z})\\]`;
        document.getElementById(
          "fifth"
        ).innerHTML = `រាងត្រីកោណមាត្រ៖ \\[z=${module}(\\cos(${
          radianFrac[Result.radian]
        }) + i\\sin(${radianFrac[Result.radian]}))\\]`;
        MathJax.typeset();
      });
    </script>
  </body>
</html>
